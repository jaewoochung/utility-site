{"ast":null,"code":"\"use strict\";\n\nvar request = require('request'),\n    handleError = require('./errorHandler').handleError,\n    handleHttpError = require('./errorHandler').handleHttpError,\n    Base = require('./Base'),\n    Account = require('./model/Account'),\n    Address = require('./model/Address'),\n    Buy = require('./model/Buy'),\n    Checkout = require('./model/Checkout'),\n    Deposit = require('./model/Deposit'),\n    Merchant = require('./model/Merchant'),\n    Notification = require('./model/Notification'),\n    Order = require('./model/Order'),\n    PaymentMethod = require('./model/PaymentMethod'),\n    Sell = require('./model/Sell'),\n    Transaction = require('./model/Transaction'),\n    User = require('./model/User'),\n    Withdrawal = require('./model/Withdrawal'),\n    crypto = require('crypto'),\n    _ = require('lodash'),\n    qs = require('querystring'),\n    assign = require('object-assign'),\n    CERT_STORE = require('./CoinbaseCertStore');\n\nvar BASE_URI = 'https://api.coinbase.com/v2/';\nvar TOKEN_ENDPOINT_URI = 'https://api.coinbase.com/oauth/token';\nvar MODELS = {\n  'account': Account,\n  'address': Address,\n  'buy': Buy,\n  'checkout': Checkout,\n  'deposit': Deposit,\n  'merchant': Merchant,\n  'notification': Notification,\n  'order': Order,\n  'payment_method': PaymentMethod,\n  'sell': Sell,\n  'transaction': Transaction,\n  'user': User,\n  'withdrawal': Withdrawal\n}; //\n// constructor\n//\n// opts = {\n//   'apiKey'       : apyKey,\n//   'apiSecret'    : apySecret,\n//   'baseApiUri'   : baseApiUri,\n//   'tokenUri'     : tokenUri,\n//   'caFile'       : caFile,\n//   'strictSSL'    : strictSSL,\n//   'accessToken'  : accessToken,\n//   'refreshToken' : refreshToken,\n//   'version'      : version\n// };\n\nfunction ClientBase(opts) {\n  if (!(this instanceof ClientBase)) {\n    return new ClientBase(opts);\n  } // assign defaults and options to the context\n\n\n  assign(this, {\n    baseApiUri: BASE_URI,\n    tokenUri: TOKEN_ENDPOINT_URI,\n    caFile: CERT_STORE,\n    strictSSL: true,\n    timeout: 5000\n  }, opts); // check for the different auth strategies\n\n  var api = !!(this.apiKey && this.apiSecret);\n  var oauth = !!this.accessToken; // XOR\n\n  if (!(api ^ oauth)) {\n    throw new Error('you must either provide an \"accessToken\" or the \"apiKey\" & \"apiSecret\" parameters');\n  }\n}\n\nClientBase.prototype = Object.create(Base.prototype); //\n// private methods\n//\n\nClientBase.prototype._setAccessToken = function (path) {\n  // OAuth access token\n  if (this.accessToken) {\n    if (path.indexOf('?') > -1) {\n      return path + '&access_token=' + this.accessToken;\n    }\n\n    return path + '?access_token=' + this.accessToken;\n  }\n\n  return path;\n};\n\nClientBase.prototype._generateSignature = function (path, method, bodyStr) {\n  var timestamp = Math.floor(Date.now() / 1000);\n  var message = timestamp + method + '/v2/' + path + bodyStr;\n  var signature = crypto.createHmac('sha256', this.apiSecret).update(message).digest('hex');\n  return {\n    'digest': signature,\n    'timestamp': timestamp\n  };\n};\n\nClientBase.prototype._generateReqOptions = function (url, path, body, method, headers) {\n  var bodyStr = body ? JSON.stringify(body) : ''; // specify the options\n\n  var options = {\n    'url': url,\n    'ca': this.caFile,\n    'strictSSL': this.strictSSL,\n    'body': bodyStr,\n    'method': method,\n    'timeout': this.timeout,\n    'headers': {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      'User-Agent': 'coinbase/node/1.0.4'\n    }\n  };\n  options.headers = assign(options.headers, headers); // add additional headers when we're using the \"api key\" and \"api secret\"\n\n  if (this.apiSecret && this.apiKey) {\n    var sig = this._generateSignature(path, method, bodyStr); // add signature and nonce to the header\n\n\n    options.headers = assign(options.headers, {\n      'CB-ACCESS-SIGN': sig.digest,\n      'CB-ACCESS-TIMESTAMP': sig.timestamp,\n      'CB-ACCESS-KEY': this.apiKey,\n      'CB-VERSION': this.version || '2016-02-18'\n    });\n  }\n\n  return options;\n};\n\nClientBase.prototype._getHttp = function (path, args, callback, headers) {\n  var params = '';\n\n  if (args && !_.isEmpty(args)) {\n    params = '?' + qs.stringify(args);\n  }\n\n  var url = this.baseApiUri + this._setAccessToken(path + params);\n\n  var opts = this._generateReqOptions(url, path + params, null, 'GET', headers);\n\n  request.get(opts, function onGet(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (!body) {\n        callback(new Error(\"empty response\"), null);\n      } else {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      }\n    }\n  });\n};\n\nClientBase.prototype._postHttp = function (path, body, callback, headers) {\n  var url = this.baseApiUri + this._setAccessToken(path);\n\n  body = body || {};\n\n  var options = this._generateReqOptions(url, path, body, 'POST', headers);\n\n  request.post(options, function onPost(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (body) {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      } else {\n        callback(null, body);\n      }\n    }\n  });\n};\n\nClientBase.prototype._putHttp = function (path, body, callback, headers) {\n  var url = this.baseApiUri + this._setAccessToken(path);\n\n  var options = this._generateReqOptions(url, path, body, 'PUT', headers);\n\n  request.put(options, function onPut(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (body) {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      } else {\n        callback(null, body);\n      }\n    }\n  });\n};\n\nClientBase.prototype._deleteHttp = function (path, callback, headers) {\n  var url = this.baseApiUri + this._setAccessToken(path);\n\n  request.del(url, this._generateReqOptions(url, path, null, 'DELETE', headers), function onDel(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      callback(null, body);\n    }\n  });\n}; //\n// opts = {\n//   'colName'        : colName,\n//   'next_uri'       : next_uri,\n//   'starting_after' : starting_after,\n//   'ending_before'  : ending_before,\n//   'limit'          : limit,\n//   'order'          : order\n// };\n// ```\n//\n\n\nClientBase.prototype._getAllHttp = function (opts, callback, headers) {\n  var self = this;\n  var args = {};\n  var path;\n\n  if (this.hasField(opts, 'next_uri')) {\n    path = opts.next_uri.replace('/v2/', '');\n    args = null;\n  } else {\n    path = opts.colName;\n\n    if (this.hasField(opts, 'starting_after')) {\n      args.starting_after = opts.starting_after;\n    }\n\n    if (this.hasField(opts, 'ending_before')) {\n      args.ending_before = opts.ending_before;\n    }\n\n    if (this.hasField(opts, 'limit')) {\n      args.limit = opts.limit;\n    }\n\n    if (this.hasField(opts, 'order')) {\n      args.order = opts.order;\n    }\n  }\n\n  this._getHttp(path, args, function onGet(err, result) {\n    if (!handleError(err, result, callback)) {\n      var objs = [];\n\n      if (result.data.length !== 0) {\n        var ObjFunc = self._stringToClass(result.data[0].resource);\n\n        objs = _.map(result.data, function onMap(obj) {\n          return new ObjFunc(self, obj);\n        });\n      }\n\n      callback(null, objs, result.pagination);\n    }\n  }, headers);\n}; //\n// args = {\n// 'path'     : path,\n// 'params'   : params,\n// }\n//\n\n\nClientBase.prototype._getOneHttp = function (args, callback, headers) {\n  var self = this;\n\n  this._getHttp(args.path, args.params, function onGet(err, obj) {\n    if (!handleError(err, obj, callback)) {\n      if (obj.data.resource) {\n        var ObjFunc = self._stringToClass(obj.data.resource);\n\n        callback(null, new ObjFunc(self, obj.data));\n      } else {\n        callback(null, obj);\n      }\n    }\n  }, headers);\n}; //\n// opts = {\n// 'colName'  : colName,\n// 'params'   : args\n// }\n//\n\n\nClientBase.prototype._postOneHttp = function (opts, callback, headers) {\n  var self = this;\n  var body = opts.params;\n\n  this._postHttp(opts.colName, body, function onPost(err, obj) {\n    if (!handleError(err, obj, callback)) {\n      if (obj.data.resource) {\n        var ObjFunc = self._stringToClass(obj.data.resource);\n\n        callback(null, new ObjFunc(self, obj.data));\n      } else {\n        callback(null, obj);\n      }\n    }\n  }, headers);\n};\n\nClientBase.prototype._stringToClass = function (name) {\n  return MODELS[name];\n};\n\nmodule.exports = ClientBase;","map":{"version":3,"sources":["/Users/jaewoochung/Documents/github_repositories/dashboard/node_modules/coinbase/lib/ClientBase.js"],"names":["request","require","handleError","handleHttpError","Base","Account","Address","Buy","Checkout","Deposit","Merchant","Notification","Order","PaymentMethod","Sell","Transaction","User","Withdrawal","crypto","_","qs","assign","CERT_STORE","BASE_URI","TOKEN_ENDPOINT_URI","MODELS","ClientBase","opts","baseApiUri","tokenUri","caFile","strictSSL","timeout","api","apiKey","apiSecret","oauth","accessToken","Error","prototype","Object","create","_setAccessToken","path","indexOf","_generateSignature","method","bodyStr","timestamp","Math","floor","Date","now","message","signature","createHmac","update","digest","_generateReqOptions","url","body","headers","JSON","stringify","options","sig","version","_getHttp","args","callback","params","isEmpty","get","onGet","err","response","obj","parse","_postHttp","post","onPost","_putHttp","put","onPut","_deleteHttp","del","onDel","_getAllHttp","self","hasField","next_uri","replace","colName","starting_after","ending_before","limit","order","result","objs","data","length","ObjFunc","_stringToClass","resource","map","onMap","pagination","_getOneHttp","_postOneHttp","name","module","exports"],"mappings":"AAAA;;AACA,IAAIA,OAAO,GAASC,OAAO,CAAC,SAAD,CAA3B;AAAA,IACIC,WAAW,GAAKD,OAAO,CAAC,gBAAD,CAAP,CAA0BC,WAD9C;AAAA,IAEIC,eAAe,GAAKF,OAAO,CAAC,gBAAD,CAAP,CAA0BE,eAFlD;AAAA,IAGIC,IAAI,GAAYH,OAAO,CAAC,QAAD,CAH3B;AAAA,IAIII,OAAO,GAASJ,OAAO,CAAC,iBAAD,CAJ3B;AAAA,IAKIK,OAAO,GAASL,OAAO,CAAC,iBAAD,CAL3B;AAAA,IAMIM,GAAG,GAAaN,OAAO,CAAC,aAAD,CAN3B;AAAA,IAOIO,QAAQ,GAAQP,OAAO,CAAC,kBAAD,CAP3B;AAAA,IAQIQ,OAAO,GAASR,OAAO,CAAC,iBAAD,CAR3B;AAAA,IASIS,QAAQ,GAAQT,OAAO,CAAC,kBAAD,CAT3B;AAAA,IAUIU,YAAY,GAAIV,OAAO,CAAC,sBAAD,CAV3B;AAAA,IAWIW,KAAK,GAAWX,OAAO,CAAC,eAAD,CAX3B;AAAA,IAYIY,aAAa,GAAGZ,OAAO,CAAC,uBAAD,CAZ3B;AAAA,IAaIa,IAAI,GAAYb,OAAO,CAAC,cAAD,CAb3B;AAAA,IAcIc,WAAW,GAAKd,OAAO,CAAC,qBAAD,CAd3B;AAAA,IAeIe,IAAI,GAAYf,OAAO,CAAC,cAAD,CAf3B;AAAA,IAgBIgB,UAAU,GAAMhB,OAAO,CAAC,oBAAD,CAhB3B;AAAA,IAiBIiB,MAAM,GAAUjB,OAAO,CAAC,QAAD,CAjB3B;AAAA,IAkBIkB,CAAC,GAAelB,OAAO,CAAC,QAAD,CAlB3B;AAAA,IAmBImB,EAAE,GAAcnB,OAAO,CAAC,aAAD,CAnB3B;AAAA,IAoBIoB,MAAM,GAAUpB,OAAO,CAAC,eAAD,CApB3B;AAAA,IAqBIqB,UAAU,GAAMrB,OAAO,CAAC,qBAAD,CArB3B;;AAuBA,IAAIsB,QAAQ,GAAa,8BAAzB;AACA,IAAIC,kBAAkB,GAAG,sCAAzB;AAEA,IAAIC,MAAM,GAAG;AACX,aAAmBpB,OADR;AAEX,aAAmBC,OAFR;AAGX,SAAmBC,GAHR;AAIX,cAAmBC,QAJR;AAKX,aAAmBC,OALR;AAMX,cAAmBC,QANR;AAOX,kBAAmBC,YAPR;AAQX,WAAmBC,KARR;AASX,oBAAmBC,aATR;AAUX,UAAmBC,IAVR;AAWX,iBAAmBC,WAXR;AAYX,UAAmBC,IAZR;AAaX,gBAAmBC;AAbR,CAAb,C,CAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASS,UAAT,CAAoBC,IAApB,EAA0B;AAExB,MAAI,EAAE,gBAAgBD,UAAlB,CAAJ,EAAmC;AACjC,WAAO,IAAIA,UAAJ,CAAeC,IAAf,CAAP;AACD,GAJuB,CAMxB;;;AACAN,EAAAA,MAAM,CAAC,IAAD,EAAO;AACXO,IAAAA,UAAU,EAAEL,QADD;AAEXM,IAAAA,QAAQ,EAAEL,kBAFC;AAGXM,IAAAA,MAAM,EAAER,UAHG;AAIXS,IAAAA,SAAS,EAAE,IAJA;AAKXC,IAAAA,OAAO,EAAE;AALE,GAAP,EAMHL,IANG,CAAN,CAPwB,CAexB;;AACA,MAAIM,GAAG,GAAG,CAAC,EAAE,KAAKC,MAAL,IAAe,KAAKC,SAAtB,CAAX;AACA,MAAIC,KAAK,GAAG,CAAC,CAAC,KAAKC,WAAnB,CAjBwB,CAmBxB;;AACA,MAAI,EAAEJ,GAAG,GAAGG,KAAR,CAAJ,EAAoB;AAClB,UAAM,IAAIE,KAAJ,CAAU,mFAAV,CAAN;AACD;AACF;;AAEDZ,UAAU,CAACa,SAAX,GAAuBC,MAAM,CAACC,MAAP,CAAcrC,IAAI,CAACmC,SAAnB,CAAvB,C,CAEA;AACA;AACA;;AAEAb,UAAU,CAACa,SAAX,CAAqBG,eAArB,GAAuC,UAASC,IAAT,EAAe;AAEpD;AACA,MAAI,KAAKN,WAAT,EAAsB;AACpB,QAAIM,IAAI,CAACC,OAAL,CAAa,GAAb,IAAoB,CAAC,CAAzB,EAA4B;AAC1B,aAAOD,IAAI,GAAG,gBAAP,GAA0B,KAAKN,WAAtC;AACD;;AACD,WAAOM,IAAI,GAAG,gBAAP,GAA0B,KAAKN,WAAtC;AACD;;AACD,SAAOM,IAAP;AACD,CAVD;;AAYAjB,UAAU,CAACa,SAAX,CAAqBM,kBAArB,GAA0C,UAASF,IAAT,EAAeG,MAAf,EAAuBC,OAAvB,EAAgC;AACxE,MAAIC,SAAS,GAAGC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACC,GAAL,KAAa,IAAxB,CAAhB;AACA,MAAIC,OAAO,GAAGL,SAAS,GAAGF,MAAZ,GAAqB,MAArB,GAA8BH,IAA9B,GAAqCI,OAAnD;AACA,MAAIO,SAAS,GAAGpC,MAAM,CAACqC,UAAP,CAAkB,QAAlB,EAA4B,KAAKpB,SAAjC,EAA4CqB,MAA5C,CAAmDH,OAAnD,EAA4DI,MAA5D,CAAmE,KAAnE,CAAhB;AAEA,SAAO;AACL,cAAUH,SADL;AAEL,iBAAaN;AAFR,GAAP;AAID,CATD;;AAWAtB,UAAU,CAACa,SAAX,CAAqBmB,mBAArB,GAA2C,UAASC,GAAT,EAAchB,IAAd,EAAoBiB,IAApB,EAA0Bd,MAA1B,EAAkCe,OAAlC,EAA2C;AAEpF,MAAId,OAAO,GAAGa,IAAI,GAAGE,IAAI,CAACC,SAAL,CAAeH,IAAf,CAAH,GAA0B,EAA5C,CAFoF,CAIpF;;AACA,MAAII,OAAO,GAAG;AACZ,WAAOL,GADK;AAEZ,UAAM,KAAK7B,MAFC;AAGZ,iBAAa,KAAKC,SAHN;AAIZ,YAAQgB,OAJI;AAKZ,cAAUD,MALE;AAMZ,eAAW,KAAKd,OANJ;AAOZ,eAAY;AACV,sBAAqB,kBADX;AAEV,gBAAqB,kBAFX;AAGV,oBAAqB;AAHX;AAPA,GAAd;AAcAgC,EAAAA,OAAO,CAACH,OAAR,GAAkBxC,MAAM,CAAC2C,OAAO,CAACH,OAAT,EAAkBA,OAAlB,CAAxB,CAnBoF,CAsBpF;;AACA,MAAI,KAAK1B,SAAL,IAAkB,KAAKD,MAA3B,EAAmC;AACjC,QAAI+B,GAAG,GAAG,KAAKpB,kBAAL,CAAwBF,IAAxB,EAA8BG,MAA9B,EAAsCC,OAAtC,CAAV,CADiC,CAGjC;;;AACAiB,IAAAA,OAAO,CAACH,OAAR,GAAkBxC,MAAM,CAAC2C,OAAO,CAACH,OAAT,EAAkB;AACxC,wBAAkBI,GAAG,CAACR,MADkB;AAExC,6BAAuBQ,GAAG,CAACjB,SAFa;AAGxC,uBAAiB,KAAKd,MAHkB;AAIxC,oBAAc,KAAKgC,OAAL,IAAgB;AAJU,KAAlB,CAAxB;AAMD;;AAED,SAAOF,OAAP;AACD,CApCD;;AAsCAtC,UAAU,CAACa,SAAX,CAAqB4B,QAArB,GAAgC,UAASxB,IAAT,EAAeyB,IAAf,EAAqBC,QAArB,EAA+BR,OAA/B,EAAwC;AACtE,MAAIS,MAAM,GAAG,EAAb;;AACA,MAAIF,IAAI,IAAI,CAACjD,CAAC,CAACoD,OAAF,CAAUH,IAAV,CAAb,EAA8B;AAC5BE,IAAAA,MAAM,GAAG,MAAMlD,EAAE,CAAC2C,SAAH,CAAaK,IAAb,CAAf;AACD;;AAED,MAAIT,GAAG,GAAG,KAAK/B,UAAL,GAAkB,KAAKc,eAAL,CAAqBC,IAAI,GAAG2B,MAA5B,CAA5B;;AACA,MAAI3C,IAAI,GAAG,KAAK+B,mBAAL,CAAyBC,GAAzB,EAA8BhB,IAAI,GAAG2B,MAArC,EAA6C,IAA7C,EAAmD,KAAnD,EAA0DT,OAA1D,CAAX;;AAEA7D,EAAAA,OAAO,CAACwE,GAAR,CAAY7C,IAAZ,EAAkB,SAAS8C,KAAT,CAAeC,GAAf,EAAoBC,QAApB,EAA8Bf,IAA9B,EAAoC;AACpD,QAAI,CAACzD,eAAe,CAACuE,GAAD,EAAMC,QAAN,EAAgBN,QAAhB,CAApB,EAA+C;AAC7C,UAAI,CAACT,IAAL,EAAW;AACTS,QAAAA,QAAQ,CAAC,IAAI/B,KAAJ,CAAU,gBAAV,CAAD,EAA8B,IAA9B,CAAR;AACD,OAFD,MAEO;AACL,YAAIsC,GAAG,GAAGd,IAAI,CAACe,KAAL,CAAWjB,IAAX,CAAV;AACAS,QAAAA,QAAQ,CAAC,IAAD,EAAOO,GAAP,CAAR;AACD;AACF;AACF,GATD;AAUD,CAnBD;;AAqBAlD,UAAU,CAACa,SAAX,CAAqBuC,SAArB,GAAiC,UAASnC,IAAT,EAAeiB,IAAf,EAAqBS,QAArB,EAA+BR,OAA/B,EAAwC;AAEvE,MAAIF,GAAG,GAAG,KAAK/B,UAAL,GAAkB,KAAKc,eAAL,CAAqBC,IAArB,CAA5B;;AACAiB,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;;AAEA,MAAII,OAAO,GAAG,KAAKN,mBAAL,CAAyBC,GAAzB,EAA8BhB,IAA9B,EAAoCiB,IAApC,EAA0C,MAA1C,EAAkDC,OAAlD,CAAd;;AAEA7D,EAAAA,OAAO,CAAC+E,IAAR,CAAaf,OAAb,EAAsB,SAASgB,MAAT,CAAgBN,GAAhB,EAAqBC,QAArB,EAA+Bf,IAA/B,EAAqC;AACzD,QAAI,CAACzD,eAAe,CAACuE,GAAD,EAAMC,QAAN,EAAgBN,QAAhB,CAApB,EAA+C;AAC7C,UAAIT,IAAJ,EAAU;AACR,YAAIgB,GAAG,GAAGd,IAAI,CAACe,KAAL,CAAWjB,IAAX,CAAV;AACAS,QAAAA,QAAQ,CAAC,IAAD,EAAOO,GAAP,CAAR;AACD,OAHD,MAGO;AACLP,QAAAA,QAAQ,CAAC,IAAD,EAAOT,IAAP,CAAR;AACD;AACF;AACF,GATD;AAUD,CAjBD;;AAmBAlC,UAAU,CAACa,SAAX,CAAqB0C,QAArB,GAAgC,UAAStC,IAAT,EAAeiB,IAAf,EAAqBS,QAArB,EAA+BR,OAA/B,EAAwC;AAEtE,MAAIF,GAAG,GAAG,KAAK/B,UAAL,GAAkB,KAAKc,eAAL,CAAqBC,IAArB,CAA5B;;AAEA,MAAIqB,OAAO,GAAG,KAAKN,mBAAL,CAAyBC,GAAzB,EAA8BhB,IAA9B,EAAoCiB,IAApC,EAA0C,KAA1C,EAAiDC,OAAjD,CAAd;;AAEA7D,EAAAA,OAAO,CAACkF,GAAR,CAAYlB,OAAZ,EAAqB,SAASmB,KAAT,CAAeT,GAAf,EAAoBC,QAApB,EAA8Bf,IAA9B,EAAoC;AACvD,QAAI,CAACzD,eAAe,CAACuE,GAAD,EAAMC,QAAN,EAAgBN,QAAhB,CAApB,EAA+C;AAC7C,UAAIT,IAAJ,EAAU;AACR,YAAIgB,GAAG,GAAGd,IAAI,CAACe,KAAL,CAAWjB,IAAX,CAAV;AACAS,QAAAA,QAAQ,CAAC,IAAD,EAAOO,GAAP,CAAR;AACD,OAHD,MAGO;AACLP,QAAAA,QAAQ,CAAC,IAAD,EAAOT,IAAP,CAAR;AACD;AACF;AACF,GATD;AAUD,CAhBD;;AAmBAlC,UAAU,CAACa,SAAX,CAAqB6C,WAArB,GAAmC,UAASzC,IAAT,EAAe0B,QAAf,EAAyBR,OAAzB,EAAkC;AACnE,MAAIF,GAAG,GAAG,KAAK/B,UAAL,GAAkB,KAAKc,eAAL,CAAqBC,IAArB,CAA5B;;AACA3C,EAAAA,OAAO,CAACqF,GAAR,CAAY1B,GAAZ,EAAiB,KAAKD,mBAAL,CAAyBC,GAAzB,EAA8BhB,IAA9B,EAAoC,IAApC,EAA0C,QAA1C,EAAoDkB,OAApD,CAAjB,EACA,SAASyB,KAAT,CAAeZ,GAAf,EAAoBC,QAApB,EAA8Bf,IAA9B,EAAoC;AAClC,QAAI,CAACzD,eAAe,CAACuE,GAAD,EAAMC,QAAN,EAAgBN,QAAhB,CAApB,EAA+C;AAC7CA,MAAAA,QAAQ,CAAC,IAAD,EAAOT,IAAP,CAAR;AACD;AACF,GALD;AAMD,CARD,C,CAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAlC,UAAU,CAACa,SAAX,CAAqBgD,WAArB,GAAmC,UAAS5D,IAAT,EAAe0C,QAAf,EAAyBR,OAAzB,EAAkC;AACnE,MAAI2B,IAAI,GAAG,IAAX;AACA,MAAIpB,IAAI,GAAG,EAAX;AACA,MAAIzB,IAAJ;;AACA,MAAI,KAAK8C,QAAL,CAAc9D,IAAd,EAAoB,UAApB,CAAJ,EAAqC;AACnCgB,IAAAA,IAAI,GAAGhB,IAAI,CAAC+D,QAAL,CAAcC,OAAd,CAAsB,MAAtB,EAA8B,EAA9B,CAAP;AACAvB,IAAAA,IAAI,GAAG,IAAP;AACD,GAHD,MAGO;AACLzB,IAAAA,IAAI,GAAGhB,IAAI,CAACiE,OAAZ;;AACA,QAAI,KAAKH,QAAL,CAAc9D,IAAd,EAAoB,gBAApB,CAAJ,EAA2C;AACzCyC,MAAAA,IAAI,CAACyB,cAAL,GAAsBlE,IAAI,CAACkE,cAA3B;AACD;;AACD,QAAI,KAAKJ,QAAL,CAAc9D,IAAd,EAAoB,eAApB,CAAJ,EAA0C;AACxCyC,MAAAA,IAAI,CAAC0B,aAAL,GAAqBnE,IAAI,CAACmE,aAA1B;AACD;;AACD,QAAI,KAAKL,QAAL,CAAc9D,IAAd,EAAoB,OAApB,CAAJ,EAAkC;AAChCyC,MAAAA,IAAI,CAAC2B,KAAL,GAAapE,IAAI,CAACoE,KAAlB;AACD;;AACD,QAAI,KAAKN,QAAL,CAAc9D,IAAd,EAAoB,OAApB,CAAJ,EAAkC;AAChCyC,MAAAA,IAAI,CAAC4B,KAAL,GAAarE,IAAI,CAACqE,KAAlB;AACD;AACF;;AAED,OAAK7B,QAAL,CAAcxB,IAAd,EAAoByB,IAApB,EAA0B,SAASK,KAAT,CAAeC,GAAf,EAAoBuB,MAApB,EAA4B;AACpD,QAAI,CAAC/F,WAAW,CAACwE,GAAD,EAAMuB,MAAN,EAAc5B,QAAd,CAAhB,EAAyC;AACvC,UAAI6B,IAAI,GAAG,EAAX;;AACA,UAAID,MAAM,CAACE,IAAP,CAAYC,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,YAAIC,OAAO,GAAGb,IAAI,CAACc,cAAL,CAAoBL,MAAM,CAACE,IAAP,CAAY,CAAZ,EAAeI,QAAnC,CAAd;;AACAL,QAAAA,IAAI,GAAG/E,CAAC,CAACqF,GAAF,CAAMP,MAAM,CAACE,IAAb,EAAmB,SAASM,KAAT,CAAe7B,GAAf,EAAoB;AAC5C,iBAAO,IAAIyB,OAAJ,CAAYb,IAAZ,EAAkBZ,GAAlB,CAAP;AACD,SAFM,CAAP;AAGD;;AACDP,MAAAA,QAAQ,CAAC,IAAD,EAAO6B,IAAP,EAAaD,MAAM,CAACS,UAApB,CAAR;AACD;AACF,GAXD,EAWG7C,OAXH;AAYD,CAnCD,C,CAqCA;AACA;AACA;AACA;AACA;AACA;;;AACAnC,UAAU,CAACa,SAAX,CAAqBoE,WAArB,GAAmC,UAASvC,IAAT,EAAeC,QAAf,EAAyBR,OAAzB,EAAkC;AACnE,MAAI2B,IAAI,GAAG,IAAX;;AACA,OAAKrB,QAAL,CAAcC,IAAI,CAACzB,IAAnB,EAAyByB,IAAI,CAACE,MAA9B,EAAsC,SAASG,KAAT,CAAeC,GAAf,EAAoBE,GAApB,EAAyB;AAC7D,QAAI,CAAC1E,WAAW,CAACwE,GAAD,EAAME,GAAN,EAAWP,QAAX,CAAhB,EAAsC;AACpC,UAAIO,GAAG,CAACuB,IAAJ,CAASI,QAAb,EAAuB;AACrB,YAAIF,OAAO,GAAGb,IAAI,CAACc,cAAL,CAAoB1B,GAAG,CAACuB,IAAJ,CAASI,QAA7B,CAAd;;AACAlC,QAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIgC,OAAJ,CAAYb,IAAZ,EAAkBZ,GAAG,CAACuB,IAAtB,CAAP,CAAR;AACD,OAHD,MAGO;AACL9B,QAAAA,QAAQ,CAAC,IAAD,EAAOO,GAAP,CAAR;AACD;AACF;AACF,GATD,EASGf,OATH;AAUD,CAZD,C,CAcA;AACA;AACA;AACA;AACA;AACA;;;AACAnC,UAAU,CAACa,SAAX,CAAqBqE,YAArB,GAAoC,UAASjF,IAAT,EAAe0C,QAAf,EAAyBR,OAAzB,EAAkC;AACnE,MAAI2B,IAAI,GAAG,IAAX;AACA,MAAI5B,IAAI,GAAGjC,IAAI,CAAC2C,MAAhB;;AACA,OAAKQ,SAAL,CAAenD,IAAI,CAACiE,OAApB,EAA6BhC,IAA7B,EAAmC,SAASoB,MAAT,CAAgBN,GAAhB,EAAqBE,GAArB,EAA0B;AAC5D,QAAI,CAAC1E,WAAW,CAACwE,GAAD,EAAME,GAAN,EAAWP,QAAX,CAAhB,EAAsC;AACpC,UAAIO,GAAG,CAACuB,IAAJ,CAASI,QAAb,EAAuB;AACrB,YAAIF,OAAO,GAAGb,IAAI,CAACc,cAAL,CAAoB1B,GAAG,CAACuB,IAAJ,CAASI,QAA7B,CAAd;;AACAlC,QAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIgC,OAAJ,CAAYb,IAAZ,EAAkBZ,GAAG,CAACuB,IAAtB,CAAP,CAAR;AACD,OAHD,MAGO;AACL9B,QAAAA,QAAQ,CAAC,IAAD,EAAOO,GAAP,CAAR;AACD;AACF;AACF,GATA,EASEf,OATF;AAUF,CAbD;;AAeAnC,UAAU,CAACa,SAAX,CAAqB+D,cAArB,GAAsC,UAASO,IAAT,EAAe;AACnD,SAAOpF,MAAM,CAACoF,IAAD,CAAb;AACD,CAFD;;AAIAC,MAAM,CAACC,OAAP,GAAiBrF,UAAjB","sourcesContent":["\"use strict\";\nvar request       = require('request'),\n    handleError   = require('./errorHandler').handleError,\n    handleHttpError   = require('./errorHandler').handleHttpError,\n    Base          = require('./Base'),\n    Account       = require('./model/Account'),\n    Address       = require('./model/Address'),\n    Buy           = require('./model/Buy'),\n    Checkout      = require('./model/Checkout'),\n    Deposit       = require('./model/Deposit'),\n    Merchant      = require('./model/Merchant'),\n    Notification  = require('./model/Notification'),\n    Order         = require('./model/Order'),\n    PaymentMethod = require('./model/PaymentMethod'),\n    Sell          = require('./model/Sell'),\n    Transaction   = require('./model/Transaction'),\n    User          = require('./model/User'),\n    Withdrawal    = require('./model/Withdrawal'),\n    crypto        = require('crypto'),\n    _             = require('lodash'),\n    qs            = require('querystring'),\n    assign        = require('object-assign'),\n    CERT_STORE    = require('./CoinbaseCertStore');\n\nvar BASE_URI           = 'https://api.coinbase.com/v2/';\nvar TOKEN_ENDPOINT_URI = 'https://api.coinbase.com/oauth/token';\n\nvar MODELS = {\n  'account'        : Account,\n  'address'        : Address,\n  'buy'            : Buy,\n  'checkout'       : Checkout,\n  'deposit'        : Deposit,\n  'merchant'       : Merchant,\n  'notification'   : Notification,\n  'order'          : Order,\n  'payment_method' : PaymentMethod,\n  'sell'           : Sell,\n  'transaction'    : Transaction,\n  'user'           : User,\n  'withdrawal'     : Withdrawal\n};\n\n//\n// constructor\n//\n// opts = {\n//   'apiKey'       : apyKey,\n//   'apiSecret'    : apySecret,\n//   'baseApiUri'   : baseApiUri,\n//   'tokenUri'     : tokenUri,\n//   'caFile'       : caFile,\n//   'strictSSL'    : strictSSL,\n//   'accessToken'  : accessToken,\n//   'refreshToken' : refreshToken,\n//   'version'      : version\n// };\nfunction ClientBase(opts) {\n\n  if (!(this instanceof ClientBase)) {\n    return new ClientBase(opts);\n  }\n\n  // assign defaults and options to the context\n  assign(this, {\n    baseApiUri: BASE_URI,\n    tokenUri: TOKEN_ENDPOINT_URI,\n    caFile: CERT_STORE,\n    strictSSL: true,\n    timeout: 5000,\n  }, opts);\n\n  // check for the different auth strategies\n  var api = !!(this.apiKey && this.apiSecret)\n  var oauth = !!this.accessToken;\n\n  // XOR\n  if (!(api ^ oauth)) {\n    throw new Error('you must either provide an \"accessToken\" or the \"apiKey\" & \"apiSecret\" parameters');\n  }\n}\n\nClientBase.prototype = Object.create(Base.prototype);\n\n//\n// private methods\n//\n\nClientBase.prototype._setAccessToken = function(path) {\n\n  // OAuth access token\n  if (this.accessToken) {\n    if (path.indexOf('?') > -1) {\n      return path + '&access_token=' + this.accessToken;\n    }\n    return path + '?access_token=' + this.accessToken;\n  }\n  return path\n};\n\nClientBase.prototype._generateSignature = function(path, method, bodyStr) {\n  var timestamp = Math.floor(Date.now() / 1000);\n  var message = timestamp + method + '/v2/' + path + bodyStr;\n  var signature = crypto.createHmac('sha256', this.apiSecret).update(message).digest('hex');\n\n  return {\n    'digest': signature,\n    'timestamp': timestamp\n  };\n};\n\nClientBase.prototype._generateReqOptions = function(url, path, body, method, headers) {\n\n  var bodyStr = body ? JSON.stringify(body) : '';\n\n  // specify the options\n  var options = {\n    'url': url,\n    'ca': this.caFile,\n    'strictSSL': this.strictSSL,\n    'body': bodyStr,\n    'method': method,\n    'timeout': this.timeout,\n    'headers' : {\n      'Content-Type'     : 'application/json',\n      'Accept'           : 'application/json',\n      'User-Agent'       : 'coinbase/node/1.0.4'\n    }\n  };\n\n  options.headers = assign(options.headers, headers);\n\n\n  // add additional headers when we're using the \"api key\" and \"api secret\"\n  if (this.apiSecret && this.apiKey) {\n    var sig = this._generateSignature(path, method, bodyStr);\n\n    // add signature and nonce to the header\n    options.headers = assign(options.headers, {\n      'CB-ACCESS-SIGN': sig.digest,\n      'CB-ACCESS-TIMESTAMP': sig.timestamp,\n      'CB-ACCESS-KEY': this.apiKey,\n      'CB-VERSION': this.version || '2016-02-18'\n    })\n  }\n\n  return options;\n};\n\nClientBase.prototype._getHttp = function(path, args, callback, headers) {\n  var params = '';\n  if (args && !_.isEmpty(args)) {\n    params = '?' + qs.stringify(args);\n  }\n\n  var url = this.baseApiUri + this._setAccessToken(path + params);\n  var opts = this._generateReqOptions(url, path + params, null, 'GET', headers);\n\n  request.get(opts, function onGet(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (!body) {\n        callback(new Error(\"empty response\"), null);\n      } else {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      }\n    }\n  });\n};\n\nClientBase.prototype._postHttp = function(path, body, callback, headers) {\n\n  var url = this.baseApiUri + this._setAccessToken(path);\n  body = body || {}\n\n  var options = this._generateReqOptions(url, path, body, 'POST', headers);\n\n  request.post(options, function onPost(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (body) {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      } else {\n        callback(null, body);\n      }\n    }\n  });\n};\n\nClientBase.prototype._putHttp = function(path, body, callback, headers) {\n\n  var url = this.baseApiUri + this._setAccessToken(path);\n\n  var options = this._generateReqOptions(url, path, body, 'PUT', headers);\n\n  request.put(options, function onPut(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      if (body) {\n        var obj = JSON.parse(body);\n        callback(null, obj);\n      } else {\n        callback(null, body);\n      }\n    }\n  });\n};\n\n\nClientBase.prototype._deleteHttp = function(path, callback, headers) {\n  var url = this.baseApiUri + this._setAccessToken(path);\n  request.del(url, this._generateReqOptions(url, path, null, 'DELETE', headers),\n  function onDel(err, response, body) {\n    if (!handleHttpError(err, response, callback)) {\n      callback(null, body);\n    }\n  });\n};\n\n//\n// opts = {\n//   'colName'        : colName,\n//   'next_uri'       : next_uri,\n//   'starting_after' : starting_after,\n//   'ending_before'  : ending_before,\n//   'limit'          : limit,\n//   'order'          : order\n// };\n// ```\n//\nClientBase.prototype._getAllHttp = function(opts, callback, headers) {\n  var self = this;\n  var args = {}\n  var path;\n  if (this.hasField(opts, 'next_uri')) {\n    path = opts.next_uri.replace('/v2/', '');\n    args = null;\n  } else {\n    path = opts.colName;\n    if (this.hasField(opts, 'starting_after')) {\n      args.starting_after = opts.starting_after;\n    }\n    if (this.hasField(opts, 'ending_before')) {\n      args.ending_before = opts.ending_before;\n    }\n    if (this.hasField(opts, 'limit')) {\n      args.limit = opts.limit;\n    }\n    if (this.hasField(opts, 'order')) {\n      args.order = opts.order;\n    }\n  }\n\n  this._getHttp(path, args, function onGet(err, result) {\n    if (!handleError(err, result, callback)) {\n      var objs = [];\n      if (result.data.length !== 0) {\n        var ObjFunc = self._stringToClass(result.data[0].resource);\n        objs = _.map(result.data, function onMap(obj) {\n          return new ObjFunc(self, obj);\n        });\n      }\n      callback(null, objs, result.pagination);\n    }\n  }, headers);\n};\n\n//\n// args = {\n// 'path'     : path,\n// 'params'   : params,\n// }\n//\nClientBase.prototype._getOneHttp = function(args, callback, headers) {\n  var self = this;\n  this._getHttp(args.path, args.params, function onGet(err, obj) {\n    if (!handleError(err, obj, callback)) {\n      if (obj.data.resource) {\n        var ObjFunc = self._stringToClass(obj.data.resource);\n        callback(null, new ObjFunc(self, obj.data));\n      } else {\n        callback(null, obj);\n      }\n    }\n  }, headers);\n};\n\n//\n// opts = {\n// 'colName'  : colName,\n// 'params'   : args\n// }\n//\nClientBase.prototype._postOneHttp = function(opts, callback, headers) {\n   var self = this;\n   var body = opts.params;\n   this._postHttp(opts.colName, body, function onPost(err, obj) {\n    if (!handleError(err, obj, callback)) {\n      if (obj.data.resource) {\n        var ObjFunc = self._stringToClass(obj.data.resource);\n        callback(null, new ObjFunc(self, obj.data));\n      } else {\n        callback(null, obj);\n      }\n    }\n  }, headers);\n};\n\nClientBase.prototype._stringToClass = function(name) {\n  return MODELS[name]\n};\n\nmodule.exports = ClientBase;\n"]},"metadata":{},"sourceType":"script"}